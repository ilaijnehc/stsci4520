---
title: "project_questions"
author: "Thomas Russo"
date: "2023-04-18"
output: pdf_document
---
# PROBLEM 1 & 2
```{r}
library(tidyverse)
dat <- read.csv("../hurdat2-1851-2022-040723.txt", header= FALSE)


hurricane_data <- function(dat){
  hurdat <- dat %>%
    mutate(date = case_when(substr(V1,1,2) == "AL" ~ V1), .before = 1) %>%
    mutate(name = case_when(substr(V1,1,2) == "AL" ~ V2)) %>%
    mutate(name = trimws(name)) %>%
    fill(date) %>%
    fill(name) %>%
    filter(!is.na(V8))
  hurdat <- hurdat[,c(ncol(hurdat),1:(ncol(hurdat)-1))]
  return(hurdat)
}

transformed <- hurricane_data(dat)

colnames(transformed) <- c("name", "cyclone_number", "date", "time", "record_identifier" , "status", "latitude", "longitude","max_sustained_wind(knots)", "min_pressure(milibars)", "ne34_kt", "se34_kt", "sw34_kt", "nw34_kt",
"ne50_kt", "se50_kt", "sw50_kt", "nw50_kt", "ne64_kt", "se64_kt", "sw64_kt","nw64_kt" ,"r_max_wind_(nmi)")
# length(colnames(transformed))

transformed[transformed == -999] <- NA
transformed[transformed == -99] <- NA

transformed <- transformed %>%
  separate(latitude, into = c("latitude", "lat_direction"), 
           sep = "(?=[A-Za-z])", convert = TRUE) %>%
  separate(longitude, into = c("longitude", "long_direction"), 
           sep = "(?=[A-Za-z])", convert = TRUE) %>%
  mutate(latitude = ifelse(lat_direction %in% "S", -latitude, latitude),
         longitude = ifelse(long_direction %in% "W", -longitude,  longitude)) %>%
  select(-ends_with("_Direction"))

transformed
```

# PROBLEM 3
```{r}
interpolate_storm_track <- function(transformed){
  
  datetime <- as.POSIXct(paste0(transformed$date, transformed$time), format="%Y%m%d%H%M")
  minim <- min(datetime)
  maxim <- max(datetime)
  new_times <- seq(minim, maxim, by=1800) # 30 minutes
  summary(transformed[c("latitude", "longitude")])
  
  # # remove "N" or "W" from the end of long/lat values using gsub() function
  # transformed$latitude <- gsub("N", "", transformed$latitude)
  # transformed$longitude <- gsub("W", "", transformed$longitude)
  # 
  # # convert long/lat values to numeric format using as.numeric() function
  # transformed$latitude <- as.numeric(transformed$latitude)
  # transformed$longitude <- as.numeric(transformed$longitude)
  
  lat_interp <- approx(datetime, transformed$latitude, xout=new_times)$y
  lon_interp <- approx(datetime, transformed$longitude, xout=new_times)$y

  interpolated_track <- data.frame(
      date = format(new_times, "%Y-%m-%d"),
      time = format(new_times, "%H:%M:%S"),
      latitude = lat_interp,
      longitude = lon_interp
    )
}

interpolated <- interpolate_storm_track(transformed)
interpolated
```
# PROBLEM 4

```{r}
library(ggplot2)
library(maps)

plot_storm_tracks <- function(hurdat, storms) {
  # filter hurdat to only include selected storms
  hurdat_selected <- hurdat %>% filter(name %in% storms)

  # create a map of the US and country boundaries
  map_data <- map_data("world")

  # remove "N" or "W" from the end of long/lat values using gsub() function
  hurdat_selected$latitude <- gsub("N", "", hurdat_selected$latitude)
  hurdat_selected$longitude <- gsub("W", "", hurdat_selected$longitude)

  # convert long/lat values to numeric format using as.numeric() function
  hurdat_selected$latitude <- as.numeric(hurdat_selected$latitude)
  hurdat_selected$longitude <- as.numeric(hurdat_selected$longitude)

  # plot the storm tracks on top of the US map
  ggplot() +
    geom_point(data = hurdat_selected, aes(x = longitude, y = latitude, group = name, color = name)) +
    geom_path(data = map_data, aes(x = long, y = lat, group = group), colour = "gray10", size = 0.2) +
    xlim(-138, -20) + ylim(3, 55) +
    labs(title = "Storm Tracks", x = "Longitude", y = "Latitude") +
    theme_bw()
}

# example usage: plot tracks of Hurricanes Sandy
storms_to_plot <- c("SANDY", "IRMA")
plot_storm_tracks(transformed, storms_to_plot)
```

# PROBLEM 5

```{r}

```



