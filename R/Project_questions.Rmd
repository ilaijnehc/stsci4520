---
title: "project_questions"
author: "Thomas Russo"
date: "2023-04-18"
output: pdf_document
---

```{r}
library(tidyverse)
dat <- read.csv("../hurdat2-1851-2022-040723.txt", header= FALSE)


hurricane_data <- function(dat){
  hurdat <- dat %>%
    mutate(date = case_when(substr(V1,1,2) == "AL" ~ V1), .before = 1) %>%
    mutate(name = case_when(substr(V1,1,2) == "AL" ~ V2)) %>%
    mutate(name = trimws(name)) %>%
    fill(date) %>%
    fill(name) %>%
    filter(!is.na(V8))
  hurdat <- hurdat[,c(ncol(hurdat),1:(ncol(hurdat)-1))]
  return(hurdat)
}

transformed <- hurricane_data(dat)

colnames(transformed) <- c("name", "cyclone_number", "date", "time", "record_identifier" , "status", "latitude", "longitude","max_sustained_wind(knots)", "min_pressure(milibars)", "ne34_kt", "se34_kt", "sw34_kt", "nw34_kt",
"ne50_kt", "se50_kt", "sw50_kt", "nw50_kt", "ne64_kt", "se64_kt", "sw64_kt","nw64_kt" ,"r_max_wind_(nmi)")
length(colnames(transformed))

transformed[transformed == -999] <- NA
transformed[transformed == -99] <- NA

transformed[50555,]$name
```

```{r}
interpolate_storm_track <- function(transformed){
  
  datetime <- as.POSIXct(paste0(transformed$date, transformed$time), format="%Y%m%d%H%M")
  minim <- min(datetime)
  maxim <- max(datetime)
  new_times <- seq(minim, maxim, by=1800) # 30 minutes
  summary(transformed[c("latitude", "longitude")])
  
  to_numeric <- function(x){
    a <- x
    b <- str_replace_all(string=a, pattern=" ", repl="")
    c <- str_sub(b,1,4)
    d <- as.numeric(c)
    return(d)
  }
  
  transformed$latitude <- lapply(transformed$latitude, to_numeric)
  transformed$longitude <- lapply(transformed$longitude, to_numeric)
  
  lat_interp <- approx(datetime, transformed$latitude, xout=new_times)$y
  lon_interp <- approx(datetime, transformed$longitude, xout=new_times)$y

  interpolated_track <- data.frame(
      date = format(new_times, "%Y-%m-%d"),
      time = format(new_times, "%H:%M:%S"),
      latitude = lat_interp,
      longitude = lon_interp
    )
}

interpolated <- interpolate_storm_track(transformed)
interpolated
```

```{r}
library(ggplot2)
library(maps)

plot_storm_tracks <- function(hurdat, storms) {
  # filter hurdat to only include selected storms
  hurdat_selected <- hurdat %>% filter(name %in% storms)
  return(hurdat_selected)
  
  # create a map of the US and country boundaries
  map_data <- map_data("world")
  us_map_data <- subset(map_data, region %in% c("USA", "CAN", "MEX"))
  
  # plot the storm traYecks on top of the map
  ggplot() +
    geom_path(data = hurdat_selected, aes(x = longitude, y = latitude, group = name, color = name)) +
    geom_path(data = us_map_data, aes(x = long, y = lat, group = group), color = "red") +
    geom_path(data = map_data, aes(x = long, y = lat, group = group), color = "grey") +
    coord_map() +
    labs(title = "Storm Tracks", x = "Longitude", y = "Latitude") +
    theme_bw()
}

# example usage: plot tracks of Hurricanes Irma and Maria
storms_to_plot <- c("IRMA", "MARIA")
plot_storm_tracks(transformed, storms_to_plot)

```

